/**
 * spidermix 0.1.0
 * Â© 2024 (Tayira)
 */

(function (global) {
  "use strict";

  function optimizeHTML() {
    document.body.innerHTML = document.body.innerHTML.replace(/>\s+</g, "><");
  }

  function optimizeScripts() {
    const scripts = document.querySelectorAll("script");
    scripts.forEach((script) => {
      if (!script.src.includes("unpkg.com/@babel/standalone")) {
        script.setAttribute("defer", "");
      }
    });
  }

  function lazyLoadImages() {
    const images = document.querySelectorAll("img");
    images.forEach((img) => {
      img.setAttribute("loading", "lazy");
    });
  }

  function optimizeCSS() {
    const links = document.querySelectorAll('link[rel="stylesheet"]');
    links.forEach((link) => {
      link.setAttribute("media", "print");
      link.onload = function () {
        this.removeAttribute("media");
      };
    });
  }

  document.addEventListener("DOMContentLoaded", function () {
    optimizeHTML();
    optimizeScripts();
    lazyLoadImages();
    optimizeCSS();
  });

  global.spidermix = {
    version: "0.1.0",
    optimizeHTML: optimizeHTML,
    optimizeScripts: optimizeScripts,
    lazyLoadImages: lazyLoadImages,
    optimizeCSS: optimizeCSS,
  };
})(window);
